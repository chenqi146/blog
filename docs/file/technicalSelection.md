# 分布式文件系统技术选型

## 主流分布式文件系统
目前主流的分布式文件系统有：GFS、HDFS、Ceph、Lustre、MogileFS、MooseFS、FastDFS、TFS、GridFS等。


### 1. GFS (Google File System)
Google公司为了满足本公司需求而开发的基于Linux的专有分布式文件系统。尽管Google公布了该系统的一些技术细节, 但Google并没有将该系统的软件部分作为开源软件发布。


### 2. HDFS (Hadoop Distributed File System)
HDFS(Hadoop Distributed File System)是 Hadoop 项目的一个子项目。是 Hadoop 的核心组件之一, Hadoop 非常适于存储大型数据 (比如 TB 和 PB), 其就是使用 HDFS 作为存储系统. HDFS 使用多台计算机存储文件,并且提供统一的访问接口, 像是访问一个普通文件系统一样使用分布式文件系统。

#### 特性

- 数据复制：HDFS被设计用于在大型群集中的计算机之间可靠地存储非常大的文件。它将每个文件分块进行存储；除了这个文件最后一个块以外的所有块都具有相同的大小。这些块将通过复制的方式进行容错。
- 文件命名：HDFS支持传统的分层方式组织文件。用户或应用程序可以创建目录并将文件存储在这些目录中。文件系统名称空间的层次结构与大多数其他现有文件系统相似。可以创建和删除文件，将文件从一个目录移动到另一个目录或重命名文件。HDFS尚未实现用户配额。HDFS不支持硬链接或软链接。
- 健壮：HDFS的主要目标是即使在出现故障的情况下也能可靠地存储数据。三种常见的故障类型是NameNode故障，DataNode故障和网络分区。
- 适用性：应用程序访问HDFS支持多种不同的方式。HDFS本身就为应用程序提供了Java API， 同时也提供此Java API的C语言包装器。另外，HTTP浏览器也可用于浏览HDFS实例的文件。通过WebDAV协议公开HDFS的工作正在进行中。
- 可扩展性：HDFS被设计用于在大型群集中的计算机之间可靠地存储非常大的文件。可以根据当时的需求增加或减少群集。
- 高可用性：HDFS被设计用于在大型集群中的机器之间可靠地存储非常大的文件。它将每个文件存储为一系列块；文件中除最后一块以外的所有块都具有相同的大小。复制文件的块是为了容错，因此在发生任何故障的情况下数据的可用性很高。

### 3.TFS (Taobao FileSystem)

TFS（Taobao FileSystem）是一个高可扩展、高可用、高性能、面向互联网服务的分布式文件系统，主要针对海量的非结构化数据，它构筑在普通的Linux机器 集群上，可为外部提供高可靠和高并发的存储访问。TFS为淘宝提供海量小文件存储，通常文件大小不超过1M，满足了淘宝对小文件存储的需求，被广泛地应用 在淘宝各项应用中。它采用了HA架构和平滑扩容，保证了整个文件系统的可用性和扩展性。同时扁平化的数据组织结构，可将文件名映射到文件的物理地址，简化 了文件的访问流程，一定程度上为TFS提供了良好的读写性能。

##### 特性
- 全部扁平化的数据组织结构, 遗弃了传统文件系统的目录结构
- 使用HA架构和平滑扩容 
- 支持多种客户端 
- 支持大小文件存储 
- 可为外部提供高可靠和高并发的存储访问 
- 支持大文件功能  
- Resource Center Server，用于管理TFS集群的用户资源配置  
- TFS服务程序开发框架，统一TFS网络客户端库，并新增异步回调功能 
- 优化数据流，让写请求尽可能均匀的分布在不同的DataServer 


### 4. Lustre

Lustre是一个大规模的、安全可靠的，具备高可用性的集群文件系统，它是由SUN公司开发和维护的。该项目主要的目的就是开发下一代的集群文件系统，可以支持超过10000个节点，数以PB的数据量存储系统。目前Lustre已经运用在一些领域，例如HP SFS产品等。

##### 特性
- 性能增强的ext4文件系统：Lustre使用Ext4增强版日志文件系统来存储数据和元数据的。这个版本，称为ldiskfs，已得到增强，以提高性能，并提供额外的lustre功能
- POSIX相容性：完整的POSIX测试套件传递与Lustre的客户有限的。在集群中，大多数操作都是原子的，这样客户端从来没有看到过时的数据或元数据。- Lustre的支持mmap（）的文件I / O
- 高性能异构网络：Lustre的支持多种高性能，低延迟的网络，并允许远程直接内存访问（RDMA）的Infiniband（OFED）。这使得多个RDMA网络桥接使用Lustre路由的最高性能。Lustre还提供了集成网络诊断。
- 高可用性：Lustre以共享存储的方式提供主动/主动故障切换用于OSS，Lustre以共享存储的方式提供主动/被动故障切换用于MDS，这使得应用程序恢复具有透明度，Lustre可以与多种高可用整合（HA），允许故障自动转移，并没有单点故障（NSPF），多个挂载保护（MMP）可提供高度可用的系统中的错误，否则会造成文件系统损坏。
- 安全性：在lustre中，选择设置一个选项，使得Lustre只接受某个专用端口的TCP连接
- 访问控制列表（ACL），exended属性:目前，Lustre的安全模型，UNIX文件系统，加强对于POSIXACL。
- 基于对象的体系结构：客户端从磁盘上的文件结构，启用存储架构的升级,在不影响客户端的情况下被隔离。

### 5. MooseFS

MooseFS是一款相对小众的分布式文件系统，不需要修改上层应用接口即可直接使用，支持FUSE的操作方式，部署简单并提供Web界面的方式进行管理与监控，同其他分布式操作系统一样，支持在线扩容，并进行横向扩展。MooseFS还具有可找回误操作删除的文件，相当于一个回收站，方便业务进行定制；同时MooseFS对于海量小文件的读写要比大文件读写的效率高的多。

##### 特性
- 冗余：所有系统组件都是冗余的，如果发生故障，会触发自动故障转移机制，这些对用户是透明的。
- 节点上的计算：通过利用空闲的CPU和内存资源，支持在数据节点上调度计算，可以降低系统的总体拥有成本。
- 原子快照：在任何特定时间点配置文件系统都是瞬间完成且不间断。此特性非常适合用于在线备份的解决方案。
- 分层存储：将不同类别的数据分配给各种类型的存储介质，以降低总存储成本。可以将热数据存储在快速的SSD磁盘上，而将不经常使用的数据转移到更便宜，更慢的机械硬盘驱动器上。
- 本地客户端：通过专门为Linux，FreeBSD和MacOS系统设计的专用客户端（安装）组件来提高性能。
- 全局回收站：一个虚拟的全局空间，用于记录删除对象的，和每个文件和目录的配置。借助这个有利的特性，可以轻松恢复意外删除的数据。
- 配额限制：系统管理员可以灵活地设置限制，以限制每个目录的数据存储容量。
- 滚动升级：能够一次执行一个节点的升级，硬件替换和添加，而不会中断服务。此功能使您可以在不停机的情况下保持硬件平台的最新状态。
- 快速磁盘恢复：万一硬盘或硬件出现故障，系统会立即启动从冗余副本到系统内其他可用存储资源的并行数据复制。此过程比传统的磁盘重建方法快得多。
- 并行性：在执行的并行线程中执行所有“I”/“O”操作，以提供高性能的读或写操作。
- 管理界面：提供丰富的管理工具，例如基于命令行和基于Web的界面。

### 6. MogileFS
由memcahed的开发公司danga一款perl开发的产品，目前国内使用mogielFS的有图片托管网站yupoo等。MogileFS是一套高效的文件自动备份组件，由Six Apart开发，广泛应用在包括LiveJournal等web2.0站点上。

##### 特性

- 应用层服务，不需要使用和兴组件
- 无单点故障，tracker为跟踪点，mogstored为存储节点，mysql为储存元数据节点，建议使用MySQL做高可用
- 传输中立，无特殊协议，可用通过nfs和http实现通信
- 简单的命名空间，没有目录，直接存储在存储空间上，通过域来实现，不共享任何数据


### 7. GlusterFS
开源分布式横向扩展文件系统，可以根据存储需求快速调配存储，内含丰富的自动故障转移功能，且摈弃集中元数据服务器的思想。适用于数据密集型任务的可扩展网络文件系统，具有可扩展性、高性能、高可用性等特点。gluster于2011年10月7日被red hat收购。

##### 特性

- 可扩展性：可扩展的存储系统，可提供弹性和配额。
- 快照：卷和文件级快照都支持，用户可以直接发起快照请求，这意味着用户不必费心管理员即可创建快照。
- 归档：只读卷和一次写入多次读（WORM）卷都支持归档。
- 为了获得更好的性能，Gluster会对readdir（）的数据，元数据和目录条目进行缓存。
- 集成：Gluster与oVirt虚拟化管理器以及用于服务器的Nagios监控器可以集成在一起。
- 大数据：对于那些希望使用Gluster文件系统中的数据进行数据分析的人，提供了Hadoop分布式文件系统（HDFS）支持。
- libgfapi：应用程序可以绕过其他访问方式，直接使用libgfapi与Gluster对话。这对于上下文切换或内核空间复制敏感的工作负载很有用。

### 8. GridFS
MongoDB是知名的NoSQL数据库，GridFS是MongoDB的一个内置功能，它提供一组文件操作的API以利用MongoDB存储文件，GridFS的基本原理是将文件保存在两个Collection中，一个保存文件索引，一个保存文件内容，文件内容按一定大小分成若干块，每一块存在一个Document中，这种方法不仅提供了文件存储，还提供了对文件相关的一些附加属性（比如MD5值，文件名等等）的存储。文件在GridFS中会按4MB为单位进行分块存储。

##### 特性
- GridFS是用于存储和检索超过16MB的BSON文档大小限制的文件的解决方案。
- GridFS是MongoDB用来存储大型二进制文件的一种存储机制。
- GridFS 不是讲文件存储在单个文档中，而是将文件分为块，并将每个块作为单独的文档存储，默认情况下，GridFS使用的块大小为256kb,最后一个块除外。
- GridFS 使用两个集合存储文件，一个集合文件的块，另一个存储文件的原始数据。


### 9. MinIO
MinIO 是一个基于Apache License v2.0开源协议的对象存储服务。它兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而一个对象文件可以是任意大小，从几kb到最大5T不等。

- Minio 有良好的存储机制
- Minio 有很好纠删码的算法与擦除编码算法
- 拥有RS code 编码数据恢复原理
- 公司做强做大时，数据的拥有重要性，对数据治理与大数据分析做准备。
- 搭建自己的一套文件系统服务,对文件数据进行安全保护。
- 拥有自己的平台，不限于其他方限制。



## 分布式文件系统对比

### 综合性对比
|文件系统|	开发者|	开发语言|	开源协议|	易用性|	适用场景|	特性|	缺点|
|---|---|---|---|---|---|---|---|
|GFS|Google||不开源|||||
|HDFS|Apache|Java|Apache|安装简单，官方文档专业化|存储非常大的文件|大数据批量读写，吞吐量高；一次写入，多次读取，顺序读写|难以满足毫秒级别的低延时数据访问；不支持多用户并发写相同文件；不适用于大量小文件|
|TFS|Alibaba|C++|GPL V2|安装复杂，官方文档少|跨集群的小文件|针对小文件量身定做，随机IO性能比较高；实现了软RAID，增强系统的并发处理能力及数据容错恢复能力；支持主备热倒换，提升系统的可用性；支持主从集群部署，从集群主要提供读/备功能|不适合大文件的存储；不支持POSIX，通用性较低；不支持自定义目录结构与文件权限控制；通过API下载，存在单点的性能瓶颈；官方文档少，学习成本高|
|Lustre|SUN|C|GPL|复杂，而且严重依赖内核，需要重新编译内核|大文件读写|企业级产品，非常庞大，对内核和ext3深度依赖||
|MooseFS|Core Sp. z o.o.|C|GPL V3|安装简单，官方文档多，且提供Web界面的方式进行管理与监控|大量小文件读写|高可靠性, 高可扩展性, 高可容错性, 高数据一致性|Master Server 本身的性能瓶颈, 对master服务器有单点依赖|
|MogileFS|Danga Interactive|Perl|GPL||主要用在web领域处理海量小图片|key-value型元文件系统；效率相比mooseFS高很多|不支持FUSE|
|GlusterFS|Z RESEARCH|C|GPL V3|安装简单，官方文档专业化|适合大文件，小文件性能还存在很大优化空间|无元数据服务器，堆栈式架构(基本功能模块可以进行堆栈式组合，实现强大功能)，具有线性横向扩展能力；比mooseFS庞大|由于没有元数据服务器，因此增加了客户端的负载，占用相当的CPU和内存；但遍历文件目录时，则实现较为复杂和低效，需要搜索所有的存储节点，不建议使用较深的路径|
|GridFS|MongoDB|C++||安装简单|通常用来处理大文件（超过16M）|可以访问部分文件，而不用向内存中加载全部文件，从而保持高性能；文件和元数据自动同步||
|MinIO|Apache|Golang|Apache|学习成本低，安装运维简单，开箱即用|非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而一个对象文件可以是任意大小，从几kb到最大5T不等|1. MinIO 服务器足够轻，可以与应用程序堆栈捆绑在一起，类似于 NodeJS，Redis 和 MySQL。<br>2. 一种高性能的分布式对象存储服务器，用于大型数据基础设施。它是机器学习和其他大数据工作负载下 Hadoop HDFS 的理想 s3 兼容替代品。|社区不够成熟，业界参考资料较少, 不支持动态增加节点，minio创始人的设计理念就是动态增加节点太复杂，目前提供对等扩容和联邦扩容。


### 特性对比
|文件系统|数据存储方式|集群节点通信协议|专用元数据存储点|在线扩容|冗余备份|单点故障|跨集群同步|FUSE挂载|访问接口|
|---|---|---|---|---|---|---|---|---|---|
HDFS   |          	文件|	私有协议（TCP）|	占用MDS|	支持|		存在|	不支持|	支持|	不支持POSIX|
Lustre|	对象|	私有协议（TCP）/ RDAM（远程直接访问内存）|	双MDS	|支持|	不支持|	存在|	未知|	支持	|POSIX/MPI|
MooseFS	|块|	私有协议（TCP）|	占用MFS	|支持|	支持	|存在	|不支持|	支持|	POSIX|
MogileFS|	文件|	HTTP|	占用DB|	支持|	不支持|	存在|	不支持	不支持|	不支持POSIX|
GlusterFS	|文件/块|	私有协议（TCP）/RDAM（远程直接访问内存）|	无|	支持|	支持|	不存在|	支持|	支持|	POSIX|
TFS	|文件|	私有协议（TCP）|	占用NS|	支持|	支持|	存在|	支持|	未知|	不支持POSIX|
MinIO| 对象|||支持|支持|存在|支持|支持|POSIX

> 什么是POSIX？
> 
> POSIX表示可移植操作系统接口（Portable Operating System Interface of UNIX，缩写为 POSIX ），也就是Unix下应用程序共同遵循的一种规范。支持POSIX的应用程序意味着在各个Unix系统间提供了跨平台运行的支持。


## 选型参考

### 按特性分类
适合做通用文件系统的有：Lustre，MooseFS，GlusterFS；

适合做小文件存储的文件系统有：MooseFS，MogileFS，TFS, MinIO；

适合做大文件存储的文件系统有：HDFS，Lustre，GlusterFS，GridFS；

轻量级文件系统有：MooseFS, MinIO；

简单易用，用户数量活跃的文件系统有：MooseFS，MogileFS，GlusterFS, MinIO；

支持FUSE挂载的文件系统有：HDFS，Lustre，MooseFS，GlusterFS, MinIO。


### 需求
1. 存储多为图片、音频、视频、文档、日志等非结构化数据
2. 支持冗余备份与容错机制
3. 国内文档齐全且安装配置简单


### 总结
建议MinIO, 文档齐全, 安装部署和运维简单, 容器化集成方便, 自带管理界面, 支持主流开发语言并且提供SDK快速集成.